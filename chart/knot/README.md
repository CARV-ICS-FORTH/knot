# Knot dashboard Helm chart

[Knot](https://github.com/CARV-ICS-FORTH/knot) is a complete environment for doing actual work on [Kubernetes](https://kubernetes.io). It includes a complete set of web-based tools to help you unleash your productivity, without ever needing to use the command line. At its core, the Knot dashboard supplies the landing page for users, allowing them to launch notebooks and other services, design workflows, and specify parameters related to execution through a user-friendly interface. The dashboard manages users, wires up relevant storage to the appropriate paths inside running containers, securely provisions multiple services under one externally-accessible HTTPS endpoint, while keeping them isolated in per-user namespaces at the Kubernetes level, and provides an identity service for OAuth 2.0/OIDC-compatible applications.

Check out the [README](https://github.com/CARV-ICS-FORTH/knot/blob/master/README.md) and the [documentation](https://carv-ics-forth.github.io/knot/docs/) for more information and pointers to deployment instructions.

> ⚠️ **This chart is for installing the Knot dashboard only** The Knot environment is installed with [Helmfile](https://github.com/roboll/helmfile), which automatically installs all required software, including the Knot dashboard, using [Helm](https://helm.sh).

## Chart usage

To deploy the Knot dashboard using [Helm](https://helm.sh), first add the repo and then install. For example:

```bash
helm repo add knot https://carv-ics-forth.github.io/knot/chart
helm install knot knot/knot --namespace default \
    --set knot.stateHostPath=/mnt/knot \
    --set knot.ingressURL=https://example.com \
    --set knot.filesURL=file:///mnt/files
```

Some of the variables set above are required. The table below lists all available options:

| Variable                        | Required | Description                                                                                   | Default                            |
|---------------------------------|----------|-----------------------------------------------------------------------------------------------|------------------------------------|
| `images.knot`                   |          | Container image to use for Knot.                                                              | `carvicsforth/knot:<version>`      |
| `images.nginx`                  |          | Container image to use for NGINX (used internally as a proxy).                                | `nginx:1.27.4-alpine`              |
| `images.vouchProxy`             |          | Container image to use for Vouch Proxy (used internally for service authentication).          | `quay.io/vouch/vouch-proxy:0.41.0` |
| `images.redis`                  |          | Container image to use for Redis (used internally for asynchronous jobs).                     | `redis:7.4.2`                      |
| `images.kubectl`                |          | Container image to use for kubectl (used internally for periodic clean up of jobs).           | `bitnami/kubectl:1.31.4`           |
| `rbac.create`                   |          | Assign full permissions to the dashboard, API and namespace discovery to authenticated users. | `true`                             |
| `knot.stateVolumeClaim`         | &check;  | If set, use this persistent volume claim for storing the database.                            |                                    |
| `knot.stateHostPath`            | &check;  | The host path to use for storing state, when no existing volume claim is set.                 |                                    |
| `knot.logsVolumeClaim`          |          | The volume to store HTTP access and error logs.                                               |                                    |
| `knot.logsHostPath`             |          | The host path to use for storing logs, when no existing volume claim is set.                  |                                    |
| `knot.themeVolumeClaim`         |          | If set, use this persistent volume claim for overriding the theme files.                      |                                    |
| `knot.themeHostPath`            |          | The host path to use for overriding the theme files, when no existing volume claim is set.    |                                    |
| `knot.djangoSecret`             |          | Secret for Django. Use a random string of 50 characters.                                      | autogenerated                      |
| `knot.djangoDebug`              |          | Set to anything to enable, empty to disable.                                                  |                                    |
| `knot.timeout`                  |          | Timeout in seconds for gunicorn workers.                                                      | `180`                              |
| `knot.adminPassword`            |          | The default admin password.                                                                   | `admin`                            |
| `knot.ldapServerURL`            |          | The URL of the LDAP server to use for authentication (include DN and password).               |                                    |
| `knot.ldapUserDNTemplate`       |          | String template that describes any user’s DN based on the username.                           |                                    |
| `knot.ldapUserAttrMap`          |          | A mapping from user field names to LDAP attribute names (in JSON format).                     | `{"username": "cn"}`               |
| `knot.htpasswdExportDir`        |          | If set, the path to export the htpasswd file in (only for local users).                       |                                    |
| `knot.dashboardTitle`           |          | The title of the dashboard.                                                                   | `Knot`                             |
| `knot.documentationURL`         |          | If set, override the internal "Documentation" URL in the user menu.                           |                                    |
| `knot.issuesURL`                |          | If set, an option to "Report an issue" is shown in the user menu.                             |                                    |
| `knot.ingressURL`               | &check;  | The ingress URL used.                                                                         |                                    |
| `knot.certificateSecretName`    |          | The name of the secret containing the self-signed certificate for the ingress.                |                                    |
| `knot.certificateSecretKey`     |          | The key in the secret holding the self-signed certificate for the ingress.                    |                                    |
| `knot.filesURL`                 | &check;  | The base URL for the private and shared file domains.                                         |                                    |
| `knot.filesSize`                |          | The size for the files persistent volume.                                                     | `1Pi`                              |
| `knot.allowedHostPathDirs`      |          | Other host paths to allow attaching to containers (separate with `:`).                        |                                    |
| `knot.disabledServices`         |          | List of services to disable on deployment.                                                    |                                    |
| `knot.serviceURLPrefixes`       |          | List of predefined URL prefixes for services.                                                 |                                    |
| `knot.developmentURL`           |          | If enabled, forward requests to another dashboard instance.                                   |                                    |
| `knot.jupyterHubURL`            |          | JupyterHub URL for integration with the notebook frontend.                                    |                                    |
| `knot.jupyterHubNamespace`      |          | JupyterHub namespace for integration.                                                         |                                    |
| `knot.jupyterHubNotebookDir`    |          | Directory to create in the private file domain for JupyterHub notebooks.                      |                                    |
| `knot.argoWorkflowsURL`         |          | Argo Workflows URL for integration with the workflow frontend.                                |                                    |
| `knot.argoWorkflowsNamespace`   |          | Argo Workflows namespace for integration.                                                     |                                    |
| `knot.harborURL`                |          | Harbor URL for integration with the container registry.                                       |                                    |
| `knot.harborNamespace`          |          | Harbor namespace for integration.                                                             |                                    |
| `knot.harborAdminPassword`      |          | Harbor admin password for fetching CLI secrets.                                               |                                    |
| `knot.giteaURL`                 |          | Gitea URL for integration with the code repository frontend.                                  |                                    |
| `knot.giteaNamespace`           |          | Gitea namespace for integration.                                                              |                                    |
| `knot.grafanaURL`               |          | Grafana URL for integration with the metrics frontend.                                        |                                    |
| `knot.grafanaNamespace`         |          | Grafana namespace for integration.                                                            |                                    |
| `knot.openCostURL`              |          | OpenCost URL for integration with the cost monitoring frontend.                               |                                    |
| `knot.openCostNamespace`        |          | OpenCost namespace for integration.                                                           |                                    |

Set `knot.filesURL` to:
* `file://<path>`, if using a node-wide, shared mountpoint for files.
* `nfs://<server>/<path>`, if using an NFS server for files.

The Knot dashboard will create `private/<username>`, `shared`, and `uploads` folders within.

The state volume is used to store the internal database. You can either use an existing peristent storage claim with `knot.stateVolumeClaim`, or set `knot.stateHostPath` to automatically create one (this must accessible by all nodes).

The theme volume is used to replace the default [theme directory](https://github.com/CARV-ICS-FORTH/knot/tree/master/dashboard/static/dashboard/theme) and should contain variants of all existing files.

To remove the Knot dashboard, uninstall using `helm uninstall knot`, which will remove the service, admission webhooks, and associated RBAC rules.
